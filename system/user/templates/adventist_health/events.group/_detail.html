{exp:channel:entries channel="events" url_title="{segment_3}" limit="1" dynamic="no"}
{__header}
<?php
// Initialize and unset session variables
unset($_SESSION['reg_form'], $_SESSION['jot_response']);

// Process URL date segment for date selection
$dateFormat = 'm-j-y';
$dateTime = DateTime::createFromFormat($dateFormat, '{last_segment}');
$selectedDate = $dateTime ? $dateTime->format($dateFormat) : '';
?>
<section class="header header--detail lightest-blue">
    <div class="container">
        <div class="header__inner">
            <div class="header__content">
                <div class="header__button">
                    <a href="{if segment_1 != 'events'}/{segment_1}{/if}/events/" class="button button--icon button--outline">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.02 319.97">
                            <path d="M182.62 9.38c12.51 12.51 12.49 32.76 0 45.25l-73.3 73.35h370.7c17.69 0 32 14.31 32 32s-14.31 32-32 32h-370.7l73.3 73.37c12.5 12.5 12.5 32.75 0 45.25s-32.75 12.5-45.25 0L9.38 182.6c-12.5-12.5-12.5-32.75 0-45.25l128-128c12.55-12.47 32.75-12.47 45.25.03Z"/>
                        </svg>
                        Events
                    </a>
                </div>
                <div class="header__copy">
                    <span class="header__eyebrow">{categories show_group="1" backspace="2"}{if category_name != 'System'}{category_name}, {if:else}Adventist Health{/if}{/categories}</span>
                    <h1>{events_title}</h1>
                    <p>{categories show_group="13" backspace="2"}{category_name}, {/categories}</p>
                </div>
            </div>
            <div class="header__image">
                {if '{events_image}' != ''}
                <img src="{events_image}" alt="Event Image">
                {if:else}
                <img src="/files/core/placeholders/event.jpg" alt="Event Image">
                {/if}
            </div>
        </div>
    </div>
</section>

<div class="page-content__wrap">
    {events_event_dates}
    <?php
    // Mapping event dates and times for the registration form
    $eventTimes = [];
    foreach ($this->EE->TMPL->tagdata_array['events_event_dates'] as $date) {
        $eventTimes[$date['date']] = $date['date format="%l, %F %j, %Y"'] . '|' . $date['event_time'];
    }
    ksort($eventTimes);
    ?>
    <aside class="sidebar">
        <!-- Event Details, Location, and Registration Form omitted for brevity -->
    </aside>

    <div class="page-content__inner">
        <!-- Main content and registration sections omitted for brevity -->
    </div>
</div>
{_footer}
{/exp:channel:entries}
