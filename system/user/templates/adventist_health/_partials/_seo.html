<?php
// ------------------------------------------
//  SEO
// ------------------------------------------

//  default values and cleaning function
// ------------------------------------------
$default_title = 'Adventist Health';
$default_description = 'Adventist Health is a faith-based, nonprofit, integrated health system serving more than 90 communities on the West Coast and Hawaii with over 400 sites of care, including 26 acute care facilities.';
$default_image = "{site_url}files/core/common/adventist-health-default.jpg";

function cleanString($string) {
  $string = html_entity_decode($string);
  $string = str_replace(array("\r", "\n"), '', $string);
  $string = preg_replace('/ {2,}/', '', $string);
  $string = trim($string);
  return $string;
}

//  title
// ------------------------------------------
$title = "
  {if global__seo_title != '' && last_segment != 'blog' && last_segment != 'news'}
    {global__seo_title}
    {if:else}$default_title $market_name
      {if last_segment =='locations'} - Locations
      {if:elseif last_segment == 'blog'} - Blog
      {if:elseif last_segment == 'news'} - News
      {if:elseif title != ''} - {title}
      {if:elseif segment_1 *='search'} - Search
      {if:else} - Page Not Found
    {/if}
  {/if}"
;
$title = cleanString($title);

//  desription
// ------------------------------------------
$description = "
  {if global__seo_description != ''}{global__seo_description}
  {if:else}$default_description
  {/if}
";
$description = cleanString($description);

//  blog or news
// ------------------------------------------
$blog_news_title = "
  {if global__seo_title != ''}{global__seo_title}{if:else}{title}{/if}
";
$blog_news_title = cleanString($blog_news_title);

//  image
// ------------------------------------------

?>

  <title><?=$title?></title>
  <meta name="description" content="<?=$description?>" />
  
  {if current_path *= 'blog/' || current_path *= 'news/'}<meta property="og:title" content="<?=$blog_news_title?>" />
  {if:else}<meta property="og:title" content="<?=$title?>" />
  {/if}<meta property="og:description" content="<?=$description?>" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="{site_url}{current_path}/" />
  {if current_path *= 'blog/' || current_path *= 'news/'}
  <meta property="og:image" content="{if global__seo_image != ''}{global__seo_image}{if:else}{news_image}{/if}" />
  {if:else}
  <meta property="og:image" content="{if global__seo_image != ''}{global__seo_image}{if:else}{site_url}files/core/common/adventist-health-default.jpg{/if}" />
  {/if}  
  {if current_path *= 'blog/' || current_path *= 'news/'}<meta property="twitter:title" content="<?=$blog_news_title?>" />
  {if:else}<meta property="twitter:title" content="<?=$title?>" />
  {/if}<meta property="twitter:card" content="summary" />
  <meta property="twitter:description" content="<?=$description?>" />
  {if current_path *= 'blog/' || current_path *= 'news/'}
  <meta property="twitter:image" content="{if global__seo_image != ''}{global__seo_image}{if:else}{news_image}{/if}" />
  {if:else}
  <meta property="twitter:image" content="{if global__seo_image != ''}{global__seo_image}{if:else}{site_url}files/core/common/adventist-health-default.jpg{/if}" />
  {/if}

 
  <meta name="robots" content="{if global__seo_robots =='' || global__seo_robots == 'index, follow'}index, follow{if:else}noindex, nofollow{/if}" />
  {if current_path *= 'blog'}
    {if segment_1 == 'blog' && last_segment == 'blog'}
    {if:elseif segment_2 == 'blog' && last_segment == 'blog'}
      <link rel="canonical" href="{site_url}blog/" />
    {if:elseif segment_2 == 'blog' && last_segment != 'blog'}
    <link rel="canonical" href="{site_url}blog/{segment_3}/{segment_4}/{segment_5}" />
    {if:else}      
    {/if}
  {/if}
  {if current_path *= 'news'}
    {if segment_1 == 'news' && last_segment == 'news'}
    {if:elseif segment_2 == 'news' && last_segment == 'news'}
      <link rel="canonical" href="{site_url}news/" />
    {if:elseif segment_2 == 'news' && last_segment != 'news'}
    <link rel="canonical" href="{site_url}news/{segment_3}/{segment_4}/{segment_5}" />
    {if:else}      
    {/if}
  {/if}
  {if current_path *= 'events'}
    {if segment_1 == 'events' && last_segment == 'events'}
    {if:elseif segment_2 == 'events' && last_segment == 'events'}
      <link rel="canonical" href="{site_url}events/" />
    {if:elseif segment_2 == 'events' && last_segment != 'events'}
    <link rel="canonical" href="{site_url}events/{segment_3}/" />
    {if:else}      
    {/if}
  {/if}
  {if current_path *= 'locations'}
    {if segment_1 == 'locations' && last_segment == 'locations'}
    {if:elseif segment_2 == 'locations' && last_segment == 'locations'}
      <link rel="canonical" href="{site_url}locations/" />
    {if:elseif segment_2 == 'locations' && last_segment != 'locations'}
    <link rel="canonical" href="{site_url}locations/{segment_3}/" />
    {if:else}      
    {/if}
  {/if}
  